function init(e){sampleRate=e.sampleRate}function record(e){recBuffersL.push(e[0]),recBuffersR.push(e[1]),recLength+=e[0].length}function exportWAV(e){var t=mergeBuffers(recBuffersL,recLength),n=mergeBuffers(recBuffersR,recLength),o=interleave(t,n),r=encodeWAV(o),i=new Blob([r],{type:e});this.postMessage(i)}function getBuffer(){var e=[];e.push(mergeBuffers(recBuffersL,recLength)),e.push(mergeBuffers(recBuffersR,recLength)),this.postMessage(e)}function clear(){recLength=0,recBuffersL=[],recBuffersR=[]}function mergeBuffers(e,t){for(var n=new Float32Array(t),o=0,r=0;r<e.length;r++)n.set(e[r],o),o+=e[r].length;return n}function interleave(e,t){for(var n=e.length+t.length,o=new Float32Array(n),r=0,i=0;n>r;)o[r++]=e[i],o[r++]=t[i],i++;return o}function floatTo16BitPCM(e,t,n){for(var o=0;o<n.length;o++,t+=2){var r=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,0>r?32768*r:32767*r,!0)}}function writeString(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}function encodeWAV(e){var t=new ArrayBuffer(44+2*e.length),n=new DataView(t);return writeString(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),writeString(n,8,"WAVE"),writeString(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,2,!0),n.setUint32(24,sampleRate,!0),n.setUint32(28,4*sampleRate,!0),n.setUint16(32,4,!0),n.setUint16(34,16,!0),writeString(n,36,"data"),n.setUint32(40,2*e.length,!0),floatTo16BitPCM(n,44,e),n}var dojo=angular.module("dojo",["ngRoute","ngDragDrop"]),dojo=angular.module("dojo");dojo.config(["$routeProvider",function(e){e.when("/",{templateUrl:"assets/template/homeTemplate.html",controller:"mainCtrl"})}]);var dojo=angular.module("dojo");dojo.controller("mainCtrl",["$scope","speechRec",function(e,t){e.speechRec=t,e.start=t.start,e.stop=t.stop,e.answer="",e.sidebar=!1,e.sidebarClass=!1,e.sidebarToggle=function(){e.sidebar=!e.sidebar,e.sidebarClass=!e.sidebarClass}}]),dojo.controller("playerCtrl",["$scope","$timeout","$routeParams","$location","$http","player","audioService","userInput","speechRec","gradingService",function(e,t,n,o,r,i,s,a,l,c){setTimeout(function(){$(".quoteLine-auto").removeClass("invisible")},700),setTimeout(function(){$(".section1-auto").removeClass("invisible")},700),setTimeout(function(){$(".section2-auto").removeClass("invisible")},1400),e.audioFiles={},s.success(function(t){e.audioFiles=t}),e.audioPlay=i.play,e.userName=a.userName,e.job=a.job,e.iAmJob=a.iAmJob,e.jobEnglish=a.jobEnglish,e.jobDanish=a.jobDanish,e.jobTitle=a.jobTitle,e.jobPronunciation=a.jobPronunciation,e.slideNum=n.slideCount,e.prevSlide=function(){e.slideNum--,e.newUrl=n.mission+"/"+n.lesson+"/slide/"+e.slideNum,o.path(e.newUrl)},e.nextSlide=function(){e.slideNum++,e.newUrl=n.mission+"/"+n.lesson+"/slide/"+e.slideNum,o.path(e.newUrl)},e.submitToNext=function(){angular.element($("#submit").addClass("hidden")),angular.element($("#next").removeClass("hidden"))},e.toGrade="",e.answerKey="",e.responseText="",e.gradeProd=function(){c.gradeProd(e.toGrade,e.answerKey),e.responseText=c.responseText,e.submitToNext()},e.gradePatt=function(){c.gradePatt(e.toGrade,e.answerKey),e.responseText=c.responseText,e.submitToNext()},e.gradeComp=function(){c.gradeComp(e.toGrade,e.answerKey),e.responseText=c.responseText,e.submitToNext()},e.gradeName=function(){a.userName=e.userName,c.gradeName(e.userName),e.submitToNext()},e.accountant=function(){a.job=e.audioFiles.revisor,a.iAmJob=e.audioFiles.jegErRevisor,a.jobDanish="revisor",a.jobEnglish="accountant",a.jobTitle="/lessons/introduce-yourself/introduction-1/images/revisorWord.png",a.jobPronunciation="/lessons/introduce-yourself/introduction-1/images/rPronunciation.png",e.nextSlide()},e.analyst=function(){a.job=e.audioFiles.analytiker,a.iAmJob=e.audioFiles.jegErAnalytiker,a.jobDanish="analytiker",a.jobEnglish="analyst",a.jobTitle="/lessons/introduce-yourself/introduction-1/images/analytikerWord.png",a.jobPronunciation="/lessons/introduce-yourself/introduction-1/images/yPronunciation.png",e.nextSlide()},e.consultant=function(){a.job=e.audioFiles.konsulent,a.iAmJob=e.audioFiles.jegErKonsulent,a.jobDanish="konsulent",a.jobEnglish="consultant",a.jobTitle="/lessons/introduce-yourself/introduction-1/images/konsulentWord.png",a.jobPronunciation="",e.nextSlide()},e.designer=function(){a.job=e.audioFiles.designer,a.iAmJob=e.audioFiles.jegErDesigner,a.jobDanish="designer",a.jobEnglish="designer",a.jobTitle="/lessons/introduce-yourself/introduction-1/images/designerWord.png",a.jobPronunciation="/lessons/introduce-yourself/introduction-1/images/rPronunciation.png",e.nextSlide()},e.engineer=function(){a.job=e.audioFiles.ingenior,a.iAmJob=e.audioFiles.jegErIngenior,a.jobDanish="ingeniør",a.jobEnglish="engineer",a.jobTitle="/lessons/introduce-yourself/introduction-1/images/ingeniorWord.png",a.jobPronunciation="/lessons/introduce-yourself/introduction-1/images/oPronunciation.png",e.nextSlide()},e.manager=function(){a.job=e.audioFiles.direktor,a.iAmJob=e.audioFiles.jegErDirektor,a.jobDanish="direktør",a.jobEnglish="manager",a.jobTitle="/lessons/introduce-yourself/introduction-1/direktorWord.png",a.jobPronunciation="/lessons/introduce-yourself/introduction-1/images/oPronunciation.png",e.nextSlide()}}]);var dojo=angular.module("dojo");dojo.directive("comprehensionAssessment",function(){return{restrict:"AE",templateUrl:"directives/compTemplate.html",replace:!0,scope:{option1:"@",option2:"@",option3:"@",option4:"@",audioFile:"=",audioPlay:"&",answerText:"@",toGrade:"=",answerKey:"=",responseText:"="},controller:["$scope",function(e){e.select=function(t){e.responseChosen=t,e.toGrade=t,e.answerKey=e.answerText,angular.element($(".section1").addClass("hidden")),angular.element($(".response-selection").removeClass("hidden")),angular.element($("#mascot").attr("src","/images/mascotChallengeBeard.png"))}}],link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("convoAssessment",function(){return{restrict:"AE",templateUrl:"directives/convoTemplate.html",replace:!0,scope:{danish:"@",placeholder:"@",answerText:"@",toGrade:"=",answerKey:"=",responseText:"=",grade:"&"},controller:["$scope","speechRec",function(e,t){e.toggleSpeechInput=function(){t.toggleStartStop()},e.answerKey=e.answerText,e.inputText="",e.formatAnswer=function(){e.toGrade=[e.inputText,e.answerText],e.inputText.toLowerCase()==e.answerText.toLowerCase()?e.responseGraded="Fantastic":e.responseGraded="Try Again"}}],link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("imagePage",function(){return{restrict:"AE",templateUrl:"directives/imageTemplate.html",replace:!0,scope:{image:"="},link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("patternAssessment",function(){return{restrict:"AE",templateUrl:"directives/patternTemplate.html",replace:!0,scope:{string:"@",list0:"=",list1:"=",list2:"=",list3:"=",answerArray:"=",toGrade:"=",answerKey:"=",responseText:"="},controller:["$scope",function(e){e.answerKey=e.answerArray,e.answers=[],e.dropCallback=function(){e.toGrade=e.answers}}],link:function(e,t,n){e.list0?e.list1?e.list2?e.list3||(angular.element($(".list3").addClass("hidden")),angular.element($(".list0").addClass("col-xs-offset-1point5"))):(angular.element($(".list2").addClass("hidden")),angular.element($(".list0").addClass("col-xs-offset-1point5"))):(angular.element($(".list1").addClass("hidden")),angular.element($(".list0").addClass("col-xs-offset-1point5"))):(angular.element($(".list0").addClass("hidden")),angular.element($(".list1").addClass("col-xs-offset-1point5")))}}});var dojo=angular.module("dojo");dojo.directive("productionAssessment",function(){return{restrict:"AE",templateUrl:"directives/prodTemplate.html",replace:!0,scope:{phrase:"@",answerText:"@",placeholder:"@",toGrade:"=",answerKey:"=",responseText:"=",grade:"&"},controller:["$scope","speechRec",function(e,t){e.toggleSpeechInput=function(){t.toggleStartStop()},e.answerKey=e.answerText,e.inputText="",e.formatAnswer=function(){e.toGrade=[e.inputText,e.answerText],e.inputText.toLowerCase()==e.answerText.toLowerCase()?e.responseGraded="Fantastic":e.responseGraded="Try Again"}}],link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("staticPage",function(){return{restrict:"AE",templateUrl:"directives/staticTemplate.html",replace:!0,scope:{string1:"@",string2:"@",string3:"@",blue:"@"},link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400),setTimeout(function(){$(".section3").removeClass("invisible")},2100)}}});var dojo=angular.module("dojo");dojo.directive("teachingPage",function(){return{restrict:"AE",templateUrl:"directives/teachingTemplate.html",replace:!0,scope:{phraseDanish:"@",phraseEnglish:"@",audioFile:"=",audioPlay:"&"},link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400),setTimeout(function(){e.audioPlay({file:e.audioFile})},2100)}}});var dojo=angular.module("dojo");dojo.factory("audio",["$document",function(e){var t=e[0].createElement("audio");return t}]),dojo.factory("player",["audio","$rootScope",function(e,t){var n={play:function(t){e.src=t,e.play(),n.playing=!0},stop:function(){n.playing&&(e.pause(),n.playing=!1)}};return e.addEventListener("ended",function(){t.$apply(n.stop())}),n}]),dojo.factory("audioService",["$http","$routeParams",function(e,t){return e.get("/lessons/"+t.mission+"/audioList.json")}]);var dojo=angular.module("dojo");dojo.service("gradingService",function(){this.responseText="",this.answerKey="",this.gradeComp=function(e,t){this.responseText="",e===t?(responseArray=["Fantastisk!","Det er perfekt!","Du er smart!"],this.responseText=responseArray[Math.floor(Math.random()*responseArray.length)],angular.element($(".response-selection").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascot").attr("src","/images/mascotBigSmile2.png")),angular.element($(".section2").addClass("invisible"))):(this.responseText="Close, but the correct answer is "+t,angular.element($(".response-selection").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascot").attr("src","/images/mascotChallengeBeard.png")),angular.element($(".section2").addClass("invisible")))}.bind(this),this.gradeProd=function(e,t){this.responseText="",e.toLowerCase()==t.toLowerCase()?(responseArray=["Fantastisk!","Det er perfekt!","Du er smart!"],this.responseText=responseArray[Math.floor(Math.random()*responseArray.length)],angular.element($(".section1").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascot").attr("src","/images/mascotBigSmile2.png"))):(this.responseText="Try Again",angular.element($(".section1").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascot").attr("src","/images/mascotChallengeBeard.png")))}.bind(this),this.gradePatt=function(e,t){this.responseText="",e[0].title==t[0].title&&e[1].title==t[1].title?(responseArray=["Fantastisk!","Det er perfekt!","Du er smart!"],this.responseText=responseArray[Math.floor(Math.random()*responseArray.length)],angular.element($(".section1").addClass("hidden")),angular.element($(".patt-answer").removeClass("hidden"))):(this.responseText="Try Again",angular.element($(".section1").addClass("hidden")),angular.element($(".patt-answer").removeClass("hidden")))}.bind(this),this.gradeName=function(e){angular.element($(".section1").addClass("hidden")),angular.element($(".section3").addClass("invisible")),angular.element($(".section4").addClass("invisible")),angular.element($(".section3").removeClass("hidden")),angular.element($(".section4").removeClass("hidden")),angular.element($(".section3").removeClass("invisible")),setTimeout(function(){$(".section4").removeClass("invisible")},700)},this.gradeJob=function(){}});var dojo=angular.module("dojo");dojo.factory("speechRec",function(){var e={},t=!1,n=new webkitSpeechRecognition;return n.continuous=!0,n.interimResults=!0,reset=function(){t=!1,speechToggle.src="/images/recordButton.png"},n.onend=reset,n.onresult=function(e){for(var t="",n="",o=0;o<e.results.length;o++)e.results[o].isFinal?n+=e.results[o][0].transcript:t+=e.results[o][0].transcript;"yy"===n?speechInput.value="jeg":"r"===n?speechInput.value="er":"youtube"===n?speechInput.value="du":speechInput.value=n,speechInput.placeholder=t},e.toggleStartStop=function(){t?(n.stop(),reset()):(n.lang="da-DK",n.start(),t=!0,speechToggle.src="/images/stopButton.png",speechInput.value="",speechInput.placeholder="")},e});var dojo=angular.module("dojo");dojo.service("userInput",function(){this.userName="",this.job="",this.iAmJob="",this.jobEnglish="",this.jobDanish="",this.jobTitle="",this.jobPronunciation=""});var dojo=angular.module("dojo");dojo.directive("bootstrapModal",function(){return{restrict:"AE",templateUrl:"directives/bootstrapModal.html",replace:!0,scope:{title:"=",body:"=",audioFile:"=",audioPlay:"&"}}});var dojo=angular.module("dojo");dojo.directive("navigationButtons",function(){return{restrict:"AE",templateUrl:"directives/navigationbuttons.html",replace:!0,scope:{nextSlide:"&",prevSlide:"&",grade:"&",submitButton:"="},controller:["$scope",function(e){}],link:function(e,t,n){e.submitButton&&(angular.element($("#next").addClass("hidden")),angular.element($("#submit").removeClass("hidden")))}}});var dojo=angular.module("dojo");dojo.directive("progressBar",function(){return{restrict:"AE",templateUrl:"directives/progressbar.html",replace:!0,scope:{slideNumber:"=",slideMax:"="}}}),function(e){e.Fr=e.Fr||{},Fr.voice={workerPath:"js/recorderWorker.js",mp3WorkerPath:"js/mp3Worker.js",stream:!1,init_called:!1,init:function(){try{e.AudioContext=e.AudioContext||e.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.URL=e.URL||e.webkitURL,navigator.getUserMedia===!1&&alert("getUserMedia() is not supported in your browser"),this.context=new AudioContext}catch(t){alert("Web Audio API is not supported in this browser")}},record:function(e,t){t=t||function(){},this.init_called===!1&&(this.init(),this.init_called=!0),$that=this,navigator.getUserMedia({audio:!0},function(n){var o=$that.context.createMediaStreamSource(n);e===!0&&o.connect($that.context.destination),$that.recorder=new Recorder(o,{workerPath:$that.workerPath,mp3WorkerPath:$that.mp3WorkerPath}),$that.stream=n,$that.recorder.record(),t(n)},function(){alert("No live audio input")})},stop:function(){return this.recorder.stop(),this.recorder.clear(),this.stream.stop(),this},"export":function(t,n){"mp3"==n?this.recorder.exportMP3(t):this.recorder.exportWAV(function(o){if(""==n||"blob"==n)t(o);else if("base64"==n){var r=new e.FileReader;r.readAsDataURL(o),r.onloadend=function(){base64data=r.result,t(base64data)}}else if("URL"==n){var i=URL.createObjectURL(o);t(i)}})}}}(window),$(document).ready(function(){$(document).on("click","#record:not(.disabled)",function(){elem=$(this),Fr.voice.record($("#live").is(":checked"),function(){elem.addClass("hidden"),$("#stop").removeClass("hidden")})}),$(document).on("click","#record2:not(.disabled)",function(){elem=$(this),Fr.voice.record($("#live").is(":checked"),function(){elem.addClass("hidden"),$("#stop").removeClass("hidden"),$("#play").addClass("hidden")})}),$(document).on("click","#stop:not(.disabled)",function(){Fr.voice["export"](function(e){$("#audio").attr("src",e)},"URL"),Fr.voice.stop(),elem=$(this),$("#record2").removeClass("hidden"),$("#play").removeClass("hidden"),elem.addClass("hidden")}),$(document).on("click","#play:not(.disabled)",function(){$("#audio").trigger("play")})}),function(e){function t(e){function t(t,n){for(var o=0,r=0;n;)o+=e[t]<<r,r+=8,t++,n--;return o}if(1!=t(20,2))throw"Invalid compression code, not PCM";return{sampleRate:t(24,4),bitsPerSample:t(34,2),samples:e.subarray(44)}}function n(e){for(var t=new Float32Array(e.length),n=0;n<e.length;n++){var o=e[n<<1]+(e[(n<<1)+1]<<8);o>=32768&&(o|=-32768),t[n]=o/32768}return t}function o(t){for(var n="",o=new Uint8Array(t),r=o.byteLength,i=0;r>i;i++)n+=String.fromCharCode(o[i]);return e.btoa(n)}var r="recorderWorker.js",i=function(e,i){var s=i||{},a=s.bufferLen||4096;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,a,2,2);var l=new Worker(s.workerPath||r);l.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var c,u=!1;this.node.onaudioprocess=function(e){u&&l.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]})},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(s[t]=e[t])},this.record=function(){u=!0},this.stop=function(){u=!1},this.clear=function(){l.postMessage({command:"clear"})},this.getBuffer=function(e){c=e||s.callback,l.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(c=e||s.callback,t=t||s.type||"audio/wav",!c)throw new Error("Callback not set");l.postMessage({command:"exportWAV",type:t}),l.onmessage=function(e){var t=e.data;c(t)}},this.exportMP3=function(e){this.exportWAV(function(){}),c=e||s.callback;var r=new Worker(s.mp3WorkerPath||mp3WorkerPath);l.onmessage=function(e){var i,s=e.data,a=new FileReader;a.onload=function(){i=this.result;var e=new Uint8Array(i),s=t(e);r.postMessage({cmd:"init",config:{mode:3,channels:1,samplerate:s.sampleRate,bitrate:s.bitsPerSample}}),r.postMessage({cmd:"encode",buf:n(s.samples)}),r.onmessage=function(e){if("data"==e.data.cmd){var t="data:audio/mp3;base64,"+o(e.data.buf);c(t),console.log("Done converting to Mp3")}}},a.readAsArrayBuffer(s)}},e.connect(this.node),this.node.connect(this.context.destination)};i.forceDownload=function(t,n){var o=(e.URL||e.webkitURL).createObjectURL(t),r=e.document.createElement("a");r.href=o,r.download=n||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),r.dispatchEvent(i)},e.Recorder=i}(window);var recLength=0,recBuffersL=[],recBuffersR=[],sampleRate;this.onmessage=function(e){switch(e.data.command){case"init":init(e.data.config);break;case"record":record(e.data.buffer);break;case"exportWAV":exportWAV(e.data.type);break;case"getBuffer":getBuffer();break;case"clear":clear()}};