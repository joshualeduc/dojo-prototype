function init(e){sampleRate=e.sampleRate}function record(e){recBuffersL.push(e[0]),recBuffersR.push(e[1]),recLength+=e[0].length}function exportWAV(e){var t=mergeBuffers(recBuffersL,recLength),n=mergeBuffers(recBuffersR,recLength),o=interleave(t,n),s=encodeWAV(o),i=new Blob([s],{type:e});this.postMessage(i)}function getBuffer(){var e=[];e.push(mergeBuffers(recBuffersL,recLength)),e.push(mergeBuffers(recBuffersR,recLength)),this.postMessage(e)}function clear(){recLength=0,recBuffersL=[],recBuffersR=[]}function mergeBuffers(e,t){for(var n=new Float32Array(t),o=0,s=0;s<e.length;s++)n.set(e[s],o),o+=e[s].length;return n}function interleave(e,t){for(var n=e.length+t.length,o=new Float32Array(n),s=0,i=0;n>s;)o[s++]=e[i],o[s++]=t[i],i++;return o}function floatTo16BitPCM(e,t,n){for(var o=0;o<n.length;o++,t+=2){var s=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,0>s?32768*s:32767*s,!0)}}function writeString(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}function encodeWAV(e){var t=new ArrayBuffer(44+2*e.length),n=new DataView(t);return writeString(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),writeString(n,8,"WAVE"),writeString(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,2,!0),n.setUint32(24,sampleRate,!0),n.setUint32(28,4*sampleRate,!0),n.setUint16(32,4,!0),n.setUint16(34,16,!0),writeString(n,36,"data"),n.setUint32(40,2*e.length,!0),floatTo16BitPCM(n,44,e),n}var dojo=angular.module("dojo",["ui.router","ngDragDrop"]),dojo=angular.module("dojo");dojo.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("player",{url:"/viewer",templateUrl:"app/template/playerTemplate.html",controller:"loadCtrl",resolve:{lessonArray:["getLesson",function(e){return e.getLessonData()}]}}).state("player.load",{templateUrl:"app/template/loadTemplate.html "}).state("player.play",{url:"/:mission/:lesson/slide/:slideCount",templateUrl:"app/template/lessonTemplate.html",controller:"playerCtrl"}).state("home",{url:"/",templateUrl:"app/template/homeTemplate.html",controller:"mainCtrl"})}]);var dojo=angular.module("dojo");dojo.directive("comprehensionAssessment",function(){return{restrict:"AE",templateUrl:"directive/comprehension/compTemplate.html",replace:!0,scope:{data:"="},controller:["$scope",function(e){e.select=function(t){e.responseChosen=t,e.data.toGrade=t,angular.element($(".section1").addClass("hidden")),angular.element($(".response-selection").removeClass("hidden")),angular.element($("#mascot").attr("src","assets/images/mascotChallengeBeard.png"))}}],link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("convoAssessment",function(){return{restrict:"AE",templateUrl:"directive/conversation/convoTemplate.html",replace:!0,scope:{data:"="},controller:["$scope","speechRec",function(e,t){e.toggleSpeechInput=function(){t.toggleStartStop()},e.answerKey=e.answerText,e.inputText="",e.formatAnswer=function(){e.toGrade=[e.inputText,e.answerText],e.inputText.toLowerCase()==e.answerText.toLowerCase()?e.responseGraded="Fantastic":e.responseGraded="Try Again"}}],link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("imagePage",function(){return{restrict:"AE",templateUrl:"directive/imagepage/imageTemplate.html",replace:!0,scope:{data:"="},link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("patternAssessment",function(){return{restrict:"AE",templateUrl:"directive/pattern/pattTemplate.html",replace:!0,scope:{data:"="},controller:["$scope",function(e){e.data.answers=[],e.dropCallback=function(){e.data.toGrade=e.data.answers}}],link:function(e,t,n){e.data.prompt&&(e.data.list0[0]?e.data.list1[0]?e.data.list2[0]?e.data.list3[0]||(angular.element($(".list3").addClass("hidden")),angular.element($(".list0").addClass("col-xs-offset-1point5"))):(angular.element($(".list2").addClass("hidden")),angular.element($(".list0").addClass("col-xs-offset-1point5"))):(angular.element($(".list1").addClass("hidden")),angular.element($(".list0").addClass("col-xs-offset-1point5"))):(angular.element($(".list0").addClass("hidden")),angular.element($(".list1").addClass("col-xs-offset-1point5"))))}}});var dojo=angular.module("dojo");dojo.directive("productionAssessment",function(){return{restrict:"AE",templateUrl:"directive/production/prodTemplate.html",replace:!0,scope:{data:"="},controller:["$scope","speechRec",function(e,t){e.toggleSpeechInput=function(){t.toggleStartStop()}}],link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400)}}});var dojo=angular.module("dojo");dojo.directive("staticPage",function(){return{restrict:"AE",templateUrl:"directive/static/staticTemplate.html",replace:!0,scope:{data:"="},link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400),setTimeout(function(){$(".section3").removeClass("invisible")},2100)}}});var dojo=angular.module("dojo");dojo.directive("teachingPage",function(){return{restrict:"AE",templateUrl:"directive/teaching/teachingTemplate.html",replace:!0,scope:{data:"="},link:function(e,t,n){setTimeout(function(){$(".quoteLine").removeClass("invisible")},700),setTimeout(function(){$(".section1").removeClass("invisible")},700),setTimeout(function(){$(".section2").removeClass("invisible")},1400),setTimeout(function(){e.data.audioPlay(e.data.audioFile)},2100)}}});var dojo=angular.module("dojo");dojo.directive("uniquePage",function(){return{restrict:"AE",templateUrl:"directive/unique/uniqueTemplate.html",replace:!0}});var dojo=angular.module("dojo");dojo.controller("loadCtrl",["$scope","$state","$timeout","getLesson",function(e,t,n,o){e.loadLesson=function(){o.getLessonData().then(function(n){e.lessonArray=n,t.go("player.play",{mission:"IntroduceYourself",lesson:"introduction1",slideCount:1})})},n(function(){e.loadLesson(),2e3})}]);var dojo=angular.module("dojo");dojo.controller("mainCtrl",["$scope","speechRec",function(e,t){e.speechRec=t,e.start=t.start,e.stop=t.stop,e.answer="",e.sidebar=!1,e.sidebarClass=!1,e.sidebarToggle=function(){e.sidebar=!e.sidebar,e.sidebarClass=!e.sidebarClass}}]);var dojo=angular.module("dojo");dojo.controller("playerCtrl",["$scope","$timeout","$stateParams","$state","$http","player","userInput","speechRec","gradingService",function(e,t,n,o,s,i,r,a,l){e.currentSlide=e.lessonArray[n.slideCount-1],e.lessonLength=e.lessonArray.length,e.currentSlide.compT&&(e.slideObj=e.currentSlide.compT),e.currentSlide.convoT&&(e.slideObj=e.currentSlide.convoT),e.currentSlide.prodT&&(e.slideObj=e.currentSlide.prodT),e.currentSlide.imgT&&(e.slideObj=e.currentSlide.imgT),e.currentSlide.statT&&(e.slideObj=e.currentSlide.statT),e.currentSlide.teachT&&(e.slideObj=e.currentSlide.teachT),e.currentSlide.uniqueT&&(e.slideObj=e.currentSlide.uniqueT),e.currentSlide.pattT.prompt&&(e.slideObj=e.currentSlide.pattT),e.slideObj.audioFile||(e.slideObj.audioFile=""),e.slideObj.audioPlay=i.play,e.slideObj.userName=r.userName,e.slideObj.job=r.job,e.slideObj.iAmJob=r.iAmJob,e.slideObj.jobEnglish=r.jobEnglish,e.slideObj.jobDanish=r.jobDanish,e.slideObj.jobTitle=r.jobTitle,e.slideObj.jobPronunciation=r.jobPronunciation,t(function(){$(".quoteLine-auto").removeClass("invisible")},700),t(function(){$(".section1-auto").removeClass("invisible")},700),t(function(){$(".section2-auto").removeClass("invisible")},1400),e.slideNum=n.slideCount,e.prevSlide=function(){e.slideNum--,o.go("player.play",{mission:n.mission,lesson:n.lesson,slideCount:e.slideNum})},e.nextSlide=function(){e.slideNum++,o.go("player.play",{mission:n.mission,lesson:n.lesson,slideCount:e.slideNum})},e.submitToNext=function(){angular.element($("#submit").addClass("hidden")),angular.element($("#next").removeClass("hidden"))},e.slideObj.toGrade="",e.slideObj.responseText="",e.gradeProd=function(){l.gradeProd(e.slideObj.toGrade,e.slideObj.answerKey),e.slideObj.responseText=l.responseText,e.submitToNext()},e.gradePatt=function(){l.gradePatt(e.slideObj.toGrade,e.slideObj.answerKey),e.slideObj.responseText=l.responseText,e.submitToNext()},e.gradeComp=function(){l.gradeComp(e.slideObj.toGrade,e.slideObj.answerKey),e.slideObj.responseText=l.responseText,e.submitToNext()},e.gradeName=function(){r.userName=e.slideObj.userName,l.gradeName(e.slideObj.userName),e.submitToNext()},e.accountant=function(){r.job="assets/lessons/introduce-yourself/introduction-1/audio/revisor.mp3",r.iAmJob="assets/lessons/introduce-yourself/introduction-1/audio/jegErRevisor.mp3",r.jobDanish="revisor",r.jobEnglish="accountant",r.jobTitle="assets/lessons/introduce-yourself/introduction-1/images/revisorWord.png",r.jobPronunciation="assets/lessons/introduce-yourself/introduction-1/images/rPronunciation.png",e.nextSlide()},e.analyst=function(){r.job="assets/lessons/introduce-yourself/introduction-1/audio/analytiker.mp3",r.iAmJob="assets/lessons/introduce-yourself/introduction-1/audio/jegErAnalytiker.mp3",r.jobDanish="analytiker",r.jobEnglish="analyst",r.jobTitle="assets/lessons/introduce-yourself/introduction-1/images/analytikerWord.png",r.jobPronunciation="assets/lessons/introduce-yourself/introduction-1/images/yPronunciation.png",e.nextSlide()},e.consultant=function(){r.job="assets/lessons/introduce-yourself/introduction-1/audio/konsulent.mp3",r.iAmJob="assets/lessons/introduce-yourself/introduction-1/audio/jegErKonsulent.mp3",r.jobDanish="konsulent",r.jobEnglish="consultant",r.jobTitle="assets/lessons/introduce-yourself/introduction-1/images/konsulentWord.png",r.jobPronunciation="",e.nextSlide()},e.designer=function(){r.job="assets/lessons/introduce-yourself/introduction-1/audio/designer.mp3",r.iAmJob="assets/lessons/introduce-yourself/introduction-1/audio/jegErDesigner.mp3",r.jobDanish="designer",r.jobEnglish="designer",r.jobTitle="assets/lessons/introduce-yourself/introduction-1/images/designerWord.png",r.jobPronunciation="assets/lessons/introduce-yourself/introduction-1/images/rPronunciation.png",e.nextSlide()},e.engineer=function(){r.job="assets/lessons/introduce-yourself/introduction-1/audio/ingenior.mp3",r.iAmJob="assets/lessons/introduce-yourself/introduction-1/audio/jegErIngenior.mp3",r.jobDanish="ingeniør",r.jobEnglish="engineer",r.jobTitle="assets/lessons/introduce-yourself/introduction-1/images/ingeniorWord.png",r.jobPronunciation="assets/lessons/introduce-yourself/introduction-1/images/oPronunciation.png",e.nextSlide()},e.manager=function(){r.job="assets/lessons/introduce-yourself/introduction-1/audio/direktor.mp3",r.iAmJob="assets/lessons/introduce-yourself/introduction-1/audio/jegErDirektor.mp3",r.jobDanish="direktør",r.jobEnglish="manager",r.jobTitle="assets/lessons/introduce-yourself/introduction-1/images/direktorWord.png",r.jobPronunciation="assets/lessons/introduce-yourself/introduction-1/images/oPronunciation.png",e.nextSlide()},e.slideObj.gradeFunc="",e.slideObj.submitButton=!1,e.slideSettings=function(){2===e.currentSlide.slidePosition?(e.slideObj.gradeFunc=e.gradeName,e.slideObj.submitButton=!0):15===e.currentSlide.slidePosition?(e.slideObj.gradeFunc=e.gradeProd,e.slideObj.submitButton=!0,e.slideObj.phrase+=" "+e.slideObj.userName,e.slideObj.answerKey+=" "+e.slideObj.userName):17===e.currentSlide.slidePosition?(e.slideObj.audioFile=e.slideObj.job,e.slideObj.danish=e.slideObj.jobDanish,e.slideObj.english=e.slideObj.jobEnglish,e.slideObj.modalTitle=e.slideObj.jobTitle,e.slideObj.modalBody=e.slideObj.jobPronunciation):18===e.currentSlide.slidePosition?(e.slideObj.gradeFunc=e.gradeProd,e.slideObj.submitButton=!0,e.slideObj.phrase=e.slideObj.jobEnglish,e.slideObj.answerKey=e.slideObj.jobDanish):19===e.currentSlide.slidePosition?(e.slideObj.gradeFunc=e.gradeProd,e.slideObj.submitButton=!0,e.slideObj.phrase+=" "+e.slideObj.jobEnglish,e.slideObj.answerKey+=" "+e.slideObj.jobDanish):e.currentSlide.compT?(e.slideObj.gradeFunc=e.gradeComp,e.slideObj.submitButton=!0):e.currentSlide.prodT?(e.slideObj.gradeFunc=e.gradeProd,e.slideObj.submitButton=!0):e.currentSlide.pattT.prompt&&(e.slideObj.gradeFunc=e.gradePatt,e.slideObj.submitButton=!0)},e.slideSettings()}]);var dojo=angular.module("dojo");dojo.factory("audio",["$document",function(e){var t=e[0].createElement("audio");return t}]),dojo.factory("player",["audio","$rootScope",function(e,t){var n={play:function(t){e.src=t,e.play(),n.playing=!0},stop:function(){n.playing&&(e.pause(),n.playing=!1)}};return e.addEventListener("ended",function(){t.$apply(n.stop())}),n}]);var dojo=angular.module("dojo");dojo.service("getLesson",["$http","$q",function(e,t){this.getLessonData=function(){var n=t.defer();return e.get("/api/lessons/IntroduceYourself").then(function(e){var t=e.data[0].firstLesson;n.resolve(t)}),n.promise}}]);var dojo=angular.module("dojo");dojo.service("gradingService",function(){this.responseText="",this.answerKey="",this.gradeComp=function(e,t){this.responseText="",e===t?(responseArray=["Fantastisk!","Det er perfekt!","Du er smart!"],this.responseText=responseArray[Math.floor(Math.random()*responseArray.length)],angular.element($(".response-selection").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascot").attr("src","assets/images/mascotBigSmile2.png")),angular.element($(".section2").addClass("invisible"))):(this.responseText="Close, but the correct answer is "+t,angular.element($(".response-selection").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascotComp").attr("src","assets/images/mascotChallengeBeard.png")),angular.element($(".section2").addClass("invisible")))}.bind(this),this.gradeProd=function(e,t){this.responseText="",e.toLowerCase()==t.toLowerCase()?(responseArray=["Fantastisk!","Det er perfekt!","Du er smart!"],this.responseText=responseArray[Math.floor(Math.random()*responseArray.length)],angular.element($(".section1").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascotProd").attr("src","assets/images/mascotBigSmile2.png")),angular.element($("#mascotConvo").attr("src","assets/images/mascotBigSmile2.png"))):(this.responseText="Try Again",angular.element($(".section1").addClass("hidden")),angular.element($(".response-answer").removeClass("hidden")),angular.element($("#mascotProd").attr("src","assets/images/mascotChallengeBeard.png")),angular.element($("#mascotConvo").attr("src","assets/images/mascotChallengeBeard.png")))}.bind(this),this.gradePatt=function(e,t){this.responseText="";var n=function(e,t){if(e.length!==t.length)return!1;for(var n=e.length;n--;)if(e[n].title!==t[n].title)return!1;return!0},o=n(e,t);o?(responseArray=["Fantastisk!","Det er perfekt!","Du er smart!"],this.responseText=responseArray[Math.floor(Math.random()*responseArray.length)],angular.element($(".section1").addClass("hidden")),angular.element($(".patt-answer").removeClass("hidden"))):(this.responseText="Try Again",angular.element($(".section1").addClass("hidden")),angular.element($(".patt-answer").removeClass("hidden")))}.bind(this),this.gradeName=function(e){angular.element($(".section1").addClass("hidden")),angular.element($(".section3").addClass("invisible")),angular.element($(".section4").addClass("invisible")),angular.element($(".section3").removeClass("hidden")),angular.element($(".section4").removeClass("hidden")),angular.element($(".section3").removeClass("invisible")),setTimeout(function(){$(".section4").removeClass("invisible")},700)},this.gradeJob=function(){}});var dojo=angular.module("dojo");dojo.factory("speechRec",function(){var e={},t=!1,n=new webkitSpeechRecognition;return n.continuous=!0,n.interimResults=!0,reset=function(){t=!1,speechToggleConvo.src="assets/images/recordButton.png",speechToggleProd.src="assets/images/recordButton.png"},n.onend=reset,n.onresult=function(e){for(var t="",n="",o=0;o<e.results.length;o++)e.results[o].isFinal?n+=e.results[o][0].transcript:t+=e.results[o][0].transcript;"yy"===n?(speechInputConvo.value="jeg",speechInputProd.value="jeg"):"r"===n?(speechInputConvo.value="er",speechInputProd.value="er"):"youtube"===n?(speechInputConvo.value="du",speechInputProd.value="du"):(speechInputConvo.value=n,speechInputProd.value=n),speechInputConvo.placeholder=t,speechInputProd.placeholder=t},e.toggleStartStop=function(){t?(n.stop(),reset()):(n.lang="da-DK",n.start(),t=!0,speechToggleConvo.src="assets/images/stopButton.png",speechToggleProd.src="assets/images/stopButton.png",speechInputConvo.value="",speechInputProd.value="",speechInputConvo.placeholder="",speechInputProd.placeholder="")},e});var dojo=angular.module("dojo");dojo.service("userInput",function(){this.userName="",this.job="",this.iAmJob="",this.jobEnglish="",this.jobDanish="",this.jobTitle="",this.jobPronunciation=""});var dojo=angular.module("dojo");dojo.directive("bootstrapModal",function(){return{restrict:"AE",templateUrl:"bootstrap/modal/modalTemplate.html",replace:!0,scope:{title:"=",body:"=",audioFile:"=",audioPlay:"&"}}});var dojo=angular.module("dojo");dojo.directive("navigationButtons",function(){return{restrict:"AE",templateUrl:"bootstrap/nav/navTemplate.html",replace:!0,scope:{nextSlide:"&",prevSlide:"&",grade:"&",submitButton:"="},controller:["$scope",function(e){}],link:function(e,t,n){e.submitButton&&(angular.element($("#next").addClass("hidden")),angular.element($("#submit").removeClass("hidden")))}}});var dojo=angular.module("dojo");dojo.directive("progressBar",function(){return{restrict:"AE",templateUrl:"bootstrap/progress/progressTemplate.html",replace:!0,scope:{slideNumber:"=",slideMax:"="}}}),function(e){e.Fr=e.Fr||{},Fr.voice={workerPath:"assets/recorderWorker.js",mp3WorkerPath:"js/mp3Worker.js",stream:!1,init_called:!1,init:function(){try{e.AudioContext=e.AudioContext||e.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.URL=e.URL||e.webkitURL,navigator.getUserMedia===!1&&alert("getUserMedia() is not supported in your browser"),this.context=new AudioContext}catch(t){alert("Web Audio API is not supported in this browser")}},record:function(e,t){t=t||function(){},this.init_called===!1&&(this.init(),this.init_called=!0),$that=this,navigator.getUserMedia({audio:!0},function(n){var o=$that.context.createMediaStreamSource(n);e===!0&&o.connect($that.context.destination),$that.recorder=new Recorder(o,{workerPath:$that.workerPath,mp3WorkerPath:$that.mp3WorkerPath}),$that.stream=n,$that.recorder.record(),t(n)},function(){alert("No live audio input")})},stop:function(){return this.recorder.stop(),this.recorder.clear(),this.stream.stop(),this},"export":function(t,n){"mp3"==n?this.recorder.exportMP3(t):this.recorder.exportWAV(function(o){if(""==n||"blob"==n)t(o);else if("base64"==n){var s=new e.FileReader;s.readAsDataURL(o),s.onloadend=function(){base64data=s.result,t(base64data)}}else if("URL"==n){var i=URL.createObjectURL(o);t(i)}})}}}(window),$(document).ready(function(){$(document).on("click","#record:not(.disabled)",function(){elem=$(this),Fr.voice.record($("#live").is(":checked"),function(){elem.addClass("hidden"),$("#stop").removeClass("hidden")})}),$(document).on("click","#record2:not(.disabled)",function(){elem=$(this),Fr.voice.record($("#live").is(":checked"),function(){elem.addClass("hidden"),$("#stop").removeClass("hidden"),$("#play").addClass("hidden")})}),$(document).on("click","#stop:not(.disabled)",function(){Fr.voice["export"](function(e){$("#audio").attr("src",e)},"URL"),Fr.voice.stop(),elem=$(this),$("#record2").removeClass("hidden"),$("#play").removeClass("hidden"),elem.addClass("hidden")}),$(document).on("click","#play:not(.disabled)",function(){$("#audio").trigger("play")})}),function(e){function t(e){function t(t,n){for(var o=0,s=0;n;)o+=e[t]<<s,s+=8,t++,n--;return o}if(1!=t(20,2))throw"Invalid compression code, not PCM";return{sampleRate:t(24,4),bitsPerSample:t(34,2),samples:e.subarray(44)}}function n(e){for(var t=new Float32Array(e.length),n=0;n<e.length;n++){var o=e[n<<1]+(e[(n<<1)+1]<<8);o>=32768&&(o|=-32768),t[n]=o/32768}return t}function o(t){for(var n="",o=new Uint8Array(t),s=o.byteLength,i=0;s>i;i++)n+=String.fromCharCode(o[i]);return e.btoa(n)}var s="assets/recorderWorker.js",i=function(e,i){var r=i||{},a=r.bufferLen||4096;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,a,2,2);var l=new Worker(r.workerPath||s);l.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var d,u=!1;this.node.onaudioprocess=function(e){u&&l.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]})},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},this.record=function(){u=!0},this.stop=function(){u=!1},this.clear=function(){l.postMessage({command:"clear"})},this.getBuffer=function(e){d=e||r.callback,l.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(d=e||r.callback,t=t||r.type||"audio/wav",!d)throw new Error("Callback not set");l.postMessage({command:"exportWAV",type:t}),l.onmessage=function(e){var t=e.data;d(t)}},this.exportMP3=function(e){this.exportWAV(function(){}),d=e||r.callback;var s=new Worker(r.mp3WorkerPath||mp3WorkerPath);l.onmessage=function(e){var i,r=e.data,a=new FileReader;a.onload=function(){i=this.result;var e=new Uint8Array(i),r=t(e);s.postMessage({cmd:"init",config:{mode:3,channels:1,samplerate:r.sampleRate,bitrate:r.bitsPerSample}}),s.postMessage({cmd:"encode",buf:n(r.samples)}),s.onmessage=function(e){if("data"==e.data.cmd){var t="data:audio/mp3;base64,"+o(e.data.buf);d(t),console.log("Done converting to Mp3")}}},a.readAsArrayBuffer(r)}},e.connect(this.node),this.node.connect(this.context.destination)};i.forceDownload=function(t,n){var o=(e.URL||e.webkitURL).createObjectURL(t),s=e.document.createElement("a");s.href=o,s.download=n||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),s.dispatchEvent(i)},e.Recorder=i}(window);var recLength=0,recBuffersL=[],recBuffersR=[],sampleRate;this.onmessage=function(e){switch(e.data.command){case"init":init(e.data.config);break;case"record":record(e.data.buffer);break;case"exportWAV":exportWAV(e.data.type);break;case"getBuffer":getBuffer();break;case"clear":clear()}};